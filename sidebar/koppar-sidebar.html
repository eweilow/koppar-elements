<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../behaviors/koppar-sidebar-behavior.html">
<link rel="import" href="../behaviors/koppar-sidebar-sliding-behavior.html">

<dom-module is="koppar-sidebar">
  <template>
    <style>
      :host {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        pointer-events: none;
        --sidebar-pane-width: 320px;
        --sidebar-pane-background: white;

        --sidebar-open-background-opacity: 0.25;
        z-index: 10000;
      }

      :host .background {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        pointer-events: none;

        opacity: 0;

        transition-property: opacity;
      }

      :host .pane {
        position: fixed;
        top: 0; left: 0; bottom: 0;
        width: var(--sidebar-pane-width);
        background: var(--sidebar-pane-background);
        -webkit-overflow-scrolling: touch;

        transition-property: transform;
        transform: none;
        pointer-events: all;
      }

      :host .pane::before {
        content: "";
        position: absolute;
        top: 0; left: 0; bottom: 0; right: 0;
        background: inherit;
        box-shadow: 0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23);
        pointer-events: none;

        transition-property: opacity;
        opacity: 0;
      }
      :host .background::before {
        content: "";
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;
        pointer-events: none;
        background: black;
        opacity: var(--sidebar-open-background-opacity);
      }

      :host .background,
      :host .pane,
      :host .pane::before {
        transition-duration: 225ms;
        transition-timing-function: cubic-bezier(0.61, 0.005, 0.815, 1);
      }

      :host([sliding]) .background,
      :host([sliding]) .pane,
      :host([sliding]) .pane::before {
        transition: none;
      }

      :host([opened]) .background,
      :host([opened]) .pane,
      :host([opened]) .pane::before {
        transition-timing-function: cubic-bezier(0.39, 0.005, 0.185, 1);
      }

      :host(:not([fixed]):not([opened])) .pane {
        transform: translate3d(calc(-var(--sidebar-pane-width) - 10px), 0, 0);
      }

      :host(:not([fixed])) .pane::before {
        opacity: 1;
      }

      :host([opened]:not([fixed])) .background {
        opacity: 1;
        pointer-events: all;
      }

    </style>
    <div id="closer" class="background"></div>
    <div id="pane" class="pane">
      <content></content>
    </div>
  </template>
  <script>
    Polymer({
      is: "koppar-sidebar",
      behaviors: [
        Koppar.SidebarBehavior,
        Koppar.SlidingSidebarBehavior
      ],
      listeners: {
        "closer.tap": "close"
      },
      created: function() {
        this.removeAttribute("unresolved");
      }
    })
  </script>
</dom-module>